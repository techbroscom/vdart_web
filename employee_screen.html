  <!DOCTYPE html>
  <html lang="en">
  <head>
        <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Food Order</title>
      <!-- Bootstrap CSS -->
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
      <!-- Custom CSS -->

      <style>
        body {
            background-color: #f8f9fa;
            margin-bottom: 60px; /* Add margin for the toggle button */
        }
        .container {
            max-width: 800px;
            margin: 50px auto;
        }
        .user-details {
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .store-list {
            background-color: #fff;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        .menu-list {
            background-color: #fff;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        .menu-item {
            margin-bottom: 10px;
        }
        .navbar {
            background-color: #007bff; /* Set the navbar color to #007bff */
        }
        .nav-header {
            background-color: #007bff;
            color: #fff;
            padding: 10px 0;
            text-align: center;
            margin-bottom: 20px;
        }
        .pending-transaction {
            /* background-color: #ffc107; Yellow color for pending */
            padding: 10px;
            margin-top: 20px;
            border-radius: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        .completed-transaction {
            background-color: #28a745; /* Green color for completed */
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .cancelled-transaction {
            background-color: #dc3545; /* Red color for cancelled */
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }

.card {
    width: 500px;
    height: 300px;
    color: #fff;
    cursor: pointer;
    perspective: 1000px;
}

.card-inner {
    width: 100%;
    height: 100%;
    position: relative;
    transition: transform 1s;
    transform-style: preserve-3d;
}

.front, .back {
    width: 100%;
    height: 100%;
    background-image: linear-gradient(45deg, #0045c7, #ff2c7d);
    position: absolute;
    top: 0;
    left: 0;
    padding: 20px 30px;
    border-radius: 15px;
    overflow: hidden;
    z-index: 1;
    backface-visibility: hidden;
}

.row {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.map-img {
    width: 100%;
    position: absolute;
    top: 0;
    left: 0;
    opacity: 0.3;
    z-index: -1;
}

.card-no {
    font-size: 35px;
    margin-top: 60px;
}

.card-holder {
    font-size: 12px;
    margin-top: 40px;
}

.name {
    font-size: 22px;
    margin-top: 20px;
}

.bar {
    background: #222;
    margin-left: -30px;
    margin-right: -30px;
    height: 60px;
    margin-top: 10px;
}

.card-cvv {
    margin-top: 20px;
}

.card-cvv div {
    flex: 1;
}

.card-cvv img {
    width: 100%;
    display: block;
    line-height: 0;
}

.card-cvv p {
    background: #fff;
    color: #000;
    font-size: 22px;
    padding: 10px 20px;
}

.card-text {
    margin-top: 30px;
    font-size: 14px;
}

.signature {
    margin-top: 30px;
}

.back {
    transform: rotateY(180deg);
}

.card:hover .card-inner {
    transform: rotateY(-180deg);
}
    </style>
</head>
<body>

    <nav class="navbar navbar-dark bg-primary center">
        <span class="navbar-brand mb-0 h1">VDart Cafe Wallets</span>
    </nav>

<div class="container">
    <!-- User Details -->
    <div class="user-details">
        <h2>Welcome, <span id="userName"></span>!</h2>
        <h4>Your Balance: <span id="userBalance"></span></h4>
        <h5>Message: <span id="userMessage"></span></h4>
    </div>

    <div>
            <div class="card">
                <div class="card-inner">
                    <div class="front">
                        <img src="https://i.ibb.co/PYss3yv/map.png" class="map-img">
                        <div class="row">
                            <img src="https://i.ibb.co/G9pDnYJ/chip.png" width="60px">
                            <img src="https://i.ibb.co/WHZ3nRJ/visa.png" width="60px">
                        </div>
                        <div class="row card-no">
                            <p>5244</p>
                            <p>2150</p>
                            <p>8252</p>
                            <p>6420</p>
                        </div>
                        <div class="row card-holder">
                            <p>CARD HPLDER</p>
                            <p>VALID TILL</p>
                        </div>
                        <div class="row name">
                            <p>JOE ALISON</p>
                            <p>10 / 25</p>
                        </div>
                    </div>
                    <div class="back">
                        <img src="https://i.ibb.co/PYss3yv/map.png" class="map-img">
                        <div class="bar"></div>
                        <div class="row card-cvv">
                            <div>
                                <img src="https://i.ibb.co/S6JG8px/pattern.png">
                            </div>
                            <p>824</p>
                        </div>
                        <div class="row card-text">
                            <p>this is a virtual card design using HTML and CSS. You can aslo design something like this.</p>
                        </div>
                        <div class="row signature">
                            <p>CUSTOMER SIGNATURE</p>
                            <img src="https://i.ibb.co/WHZ3nRJ/visa.png" width="80px">
                        </div>
                    </div>
                </div>
            </div>
    </div>

    <!-- Store List -->
    <div class="store-list">
        <h3>Stores List:</h3>
        <ul id="storesList"></ul>
    </div>

    <!-- Pending Transaction Details -->
    <div id="pendingTransaction" style="display: none;" class="pending-transaction">
        <h3>Order Details:</h3>
        <div id="pendingTransactionItems"></div>
        <p>Total: <span id="pendingTransactionTotal"></span></p>
    </div>

</div>

  <!-- Firebase JavaScript SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <!-- Initialize Firebase -->
  <script>
      const firebaseConfig = {
    apiKey: "AIzaSyCvcxuv1-MWBtHMIUkeqGH_gfyBWaNN7K0",
    authDomain: "vdarttest.firebaseapp.com",
    projectId: "vdarttest",
    storageBucket: "vdarttest.appspot.com",
    messagingSenderId: "157342186908",
    databaseURL: "https://vdarttest-default-rtdb.asia-southeast1.firebasedatabase.app",
    appId: "1:157342186908:web:ea6c53598d3e9d1cab9c59",
    measurementId: "G-NVXLVD13D1"
  };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      // Reference to the Firebase database
      const db = firebase.database();

      // Display user details
const userDetails = JSON.parse(localStorage.getItem('userDetails'));
if (!userDetails) {
    console.log('User details not found');
} else {
    document.getElementById('userName').innerText = userDetails.userName;
    document.getElementById('userBalance').innerText = userDetails.balance;
    document.getElementById('userMessage').innerText = userDetails.message;

    if (userDetails.isOrderPending) {

        document.querySelector('.store-list').style.display = 'none'; // Show the store list

    // If there is a pending order, show the transaction details
    const pendingTranId = userDetails.pendingTransId;
    const pendingStoreId = userDetails.orderStore;
    const pendingTranRef = db.ref('transactions').child(pendingStoreId).child(pendingTranId);
    pendingTranRef.once('value', snapshot => {
        const pendingTran = snapshot.val();
        if (pendingTran) {
            if(pendingTran.tStatus == "Delivered"){
                document.querySelector('.store-list').style.display = 'block'; // Show the store list

                // Update userDetails and display a message
                userDetails.isOrderPending = false;
                userDetails.message = "Your last order is delivered";
    localStorage.setItem('userDetails', JSON.stringify(userDetails));
                document.getElementById('userMessage').textContent = "Your last order is delivered";

                // Update userDetails in localStorage
                localStorage.setItem('userDetails', JSON.stringify(userDetails));

                // Update isOrderPending in the database
                const userRef = db.ref('userDetails').child(userDetails.id);
                userRef.update({
                    isOrderPending: false,
                    message: "Your last order is delivered"
                }).then(() => {
                    console.log("isOrderPending updated in the database");
                }).catch(error => {
                    console.error("Error updating isOrderPending in the database:", error);
                });
            }
            else{
            // Display pending transaction details in the new div element
            const pendingTransactionItems = document.getElementById('pendingTransactionItems');
            const pendingTransactionTotal = document.getElementById('pendingTransactionTotal');

            pendingTransactionItems.innerHTML = pendingTran.items.map(item =>
                `<div>${item.name} (Quantity: ${item.quantity}, Price: $${item.price.toFixed(2)})</div>`
            ).join('');

            pendingTransactionTotal.textContent = `$${pendingTran.tCoins.toFixed(2)}`;

            document.getElementById('pendingTransaction').style.display = 'block';
            }
        } else {
            console.log('Pending transaction not found');
        }
    });
} else {
    document.querySelector('.store-list').style.display = 'block'; // Show the store list


    // If there is no pending order, display the store list

    const storesListRef = db.ref('stores');
storesListRef.on('value', snapshot => {
    const stores = snapshot.val();
    const storesList = document.getElementById('storesList');
    if (!stores) {
        console.log('No stores found in the database');
        return;
    }
    storesList.innerHTML = ''; // Clear previous list
    for (let storeKey in stores) {
        const store = stores[storeKey];
        const storeItem = document.createElement('li');
        storeItem.className = 'list-group-item';
        storeItem.textContent = `${store.name} - ${store.location}`;
        storeItem.addEventListener('click', () => {
            // Store the menu items for the selected store in localStorage
            localStorage.setItem('menuItems', JSON.stringify(store.menu));
            localStorage.setItem('storeDetails', JSON.stringify(store));
            // Navigate to the next page with store details and menu items
            window.location.href = 'menu.html';
        });
        storesList.appendChild(storeItem);
    }
}, error => {
    console.error('Error fetching stores:', error);
});

}

}

  </script>
  </body>
  </html>
