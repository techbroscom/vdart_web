<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Transactions</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Custom CSS -->
    <style>
        /* Your CSS styles here */
    </style>
</head>
<body>

<nav class="navbar navbar-dark bg-primary center">
    <span class="navbar-brand mb-0 h1">VDart Cafe Wallets</span>
</nav>

<div class="container">
    <!-- Pending Transaction Details -->
    <div class="pending-transactions">
        <h3>All Transactions:</h3>
        <ul id="pendingTransactionsList"></ul>
    </div>
</div>

<!-- Firebase JavaScript SDK and Initialization code -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
    // Your Firebase configuration and initialization code here

    const firebaseConfig = {
    apiKey: "AIzaSyCvcxuv1-MWBtHMIUkeqGH_gfyBWaNN7K0",
    authDomain: "vdarttest.firebaseapp.com",
    projectId: "vdarttest",
    storageBucket: "vdarttest.appspot.com",
    messagingSenderId: "157342186908",
    databaseURL: "https://vdarttest-default-rtdb.asia-southeast1.firebasedatabase.app",
    appId: "1:157342186908:web:ea6c53598d3e9d1cab9c59",
    measurementId: "G-NVXLVD13D1"
  };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      // Reference to the Firebase database
      const db = firebase.database();

// Get the store user ID from localStorage or any other source
const storeDetails = JSON.parse(localStorage.getItem('userDetails')); // Assuming you store the store user ID in localStorage

const storeId = storeDetails.id;
// Reference to the pending transactions for the store user ID
const pendingTransactionsRef = db.ref('transactions').child(storeId);

// Fetch pending transactions for the store user ID
pendingTransactionsRef.once('value', snapshot => {
    const pendingTransactions = snapshot.val();
    if (pendingTransactions) {
    // Create a new workbook
    const wb = XLSX.utils.book_new();
    wb.Props = {
        Title: 'Transactions',
        Author: 'Your Name',
        CreatedDate: new Date()
    };

    // Create a worksheet for the original transactions
const originalData = Object.keys(pendingTransactions).map(transactionId => {
    const transaction = pendingTransactions[transactionId];
    return {
        tDate: transaction.tDate,
        tCoins: transaction.tCoins,
        tFrom: transaction.tFrom,
        tTo: transaction.tTo,
        tFromName: transaction.tFromName,
        tType: transaction.tType
    };
});

const originalWs = XLSX.utils.json_to_sheet(originalData);
XLSX.utils.book_append_sheet(wb, originalWs, 'Original Transactions');


    // Summarize tCoins based on tDate
const summary = {};
for (const transaction of Object.values(pendingTransactions)) {
    const tDate = transaction.tDate; // Assuming you have a tDate property in your transaction object
    const tCoins = transaction.tCoins;
    summary[tDate] = (summary[tDate] || 0) + tCoins;
}

// Create a worksheet for the summarized data
const summaryData = [];
for (const [tDate, sumOfCoins] of Object.entries(summary)) {
    summaryData.push({ tDate, 'Sum of tCoins': sumOfCoins });
}

const summaryWs = XLSX.utils.json_to_sheet(summaryData, { header: ['tDate', 'Sum of tCoins'] });
XLSX.utils.book_append_sheet(wb, summaryWs, 'Summary');

    // Convert the workbook to a binary Excel file and trigger the download
    const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'binary' });
    function s2ab(s) {
        const buf = new ArrayBuffer(s.length);
        const view = new Uint8Array(buf);
        for (let i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
        return buf;
    }
    saveAs(new Blob([s2ab(wbout)], { type: 'application/octet-stream' }), 'transactions_'+Date.now()+'.xlsx');
} else {
    console.log('No transactions found for the store user ID');
}



});


</script>

</body>
</html>