<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pending Transactions</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Custom CSS -->
    <style>
        body {
            background-color: #f8f9fa;
            margin-bottom: 60px; /* Add margin for the toggle button */
        }
        .container {
            margin: 50px auto;
        }
        .transaction-details {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 20px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .transaction-id,
        .total-coins,
        .sender-info,
        .status {
            margin-bottom: 5px;
        }
        .items {
            margin-bottom: 10px;
        }
        .items ul {
            list-style-type: none;
            padding: 0;
        }
        .items li {
            margin-bottom: 5px;
        }
        .update-button {
            background-color: #28a745;
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .update-button:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-dark bg-primary center">
    <span class="navbar-brand mb-0 h1">VDart Cafe Wallets</span>
    <button id="menuButton" class="btn btn-outline-light">Menu</button>
    <button id="logoutButton" class="btn btn-outline-light">Logout</button>
</nav>

<div class="container">
    <!-- Pending Transaction Details -->
    <div class="pending-transactions">
        <h3>Pending Transactions:</h3>
        <ul id="pendingTransactionsList"></ul>
    </div>
</div>

<!-- Firebase JavaScript SDK and Initialization code -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
    // Your Firebase configuration and initialization code here

    const firebaseConfig = {
        apiKey: "AIzaSyCvcxuv1-MWBtHMIUkeqGH_gfyBWaNN7K0",
        authDomain: "vdarttest.firebaseapp.com",
        projectId: "vdarttest",
        storageBucket: "vdarttest.appspot.com",
        messagingSenderId: "157342186908",
        databaseURL: "https://vdarttest-default-rtdb.asia-southeast1.firebasedatabase.app",
        appId: "1:157342186908:web:ea6c53598d3e9d1cab9c59",
        measurementId: "G-NVXLVD13D1"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Reference to the Firebase database
    const db = firebase.database();

    // Get the store user ID from localStorage or any other source
    const storeDetails = JSON.parse(localStorage.getItem('userDetails')); // Assuming you store the store user ID in localStorage

    const storeId = storeDetails.id;
    // Reference to the pending transactions for the store user ID
    const pendingTransactionsRef = db.ref('transactions').child(storeId);

    // Fetch pending transactions for the store user ID
    pendingTransactionsRef.once('value', snapshot => {
        const pendingTransactions = snapshot.val();
        if (pendingTransactions) {
            // Display pending transactions
            const pendingTransactionsList = document.getElementById('pendingTransactionsList');
            pendingTransactionsList.innerHTML = ''; // Clear previous list
            for (let transactionId in pendingTransactions) {
                const transaction = pendingTransactions[transactionId];
                if (transaction.tStatus === 'Pending') { // Check if status is "Pending"
                    // Display transaction details
                    const transactionItem = document.createElement('li');
                    transactionItem.innerHTML = `
                    <div class="transaction-details">
                        <div class="transaction-id"><strong>Transaction ID:</strong> ${transactionId}</div>
                        <div class="total-coins"><strong>Total:</strong> ${transaction.tCoins}</div>
                        <div class="items">
                            <strong>Items:</strong>
                            <ul>
                                ${transaction.items.map(item =>
                                    `<li>${item.name} (Quantity: ${item.quantity}, Price: $${item.price.toFixed(2)})</li>`
                                ).join('')}
                            </ul>
                        </div>
                        <div class="sender-info"><strong>From:</strong> ${transaction.tFromName}</div>
                        <div class="status"><strong>Status:</strong> ${transaction.tStatus}</div>
                        <button class="update-button" data-transaction-id="${transactionId}">Delivered</button>
                    </div>
                    `;

                    // Add click event listener to update button
                    const updateButton = transactionItem.querySelector('.update-button');
                    updateButton.addEventListener('click', () => {
                        // Update the transaction status to "Delivered" in the database
                        db.ref('transactions').child(storeId).child(transactionId).update({
                            tStatus: 'Delivered'
                        }).then(() => {
                            console.log('Transaction status updated to Delivered');
                            // Remove the transaction from the list
                            transactionItem.remove();
                        }).catch(error => {
                            console.error('Error updating transaction status:', error);
                        });
                    });

                    // Append the transaction details to the pendingTransactionsList
                    pendingTransactionsList.appendChild(transactionItem);
                }
            }
        } else {
            console.log('No pending transactions found for the store user ID');
        }
    });

          // Logout button event listener
const logoutButton = document.getElementById('logoutButton');
logoutButton.addEventListener('click', () => {
    if (confirm('Are you sure you want to logout?')) {
        // Clear user details from localStorage
        localStorage.removeItem('userDetails');
        // Redirect to the login page
        window.location.href = 'index.html';
    }
});

          // Menu button event listener
          const menuButton = document.getElementById('menuButton');
logoutButton.addEventListener('click', () => {

        // Redirect to the login page
        window.location.href = 'menu_management.html';
});
</script>

</body>
</html>
